name: Actualizar Inteligencia CVE

on:
  schedule:
    # Se ejecuta todos los d칤as a las 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch: # Permite ejecuci칩n manual desde la pesta침a Actions

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout del repositorio
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Instalar dependencias
        run: pip install requests

      - name: Ejecutar scripts de actualizaci칩n
        run: |
          # 1. Siempre descargamos los 칰ltimos de CISA
          python scripts/update_cves.py
          
          # 2. L칩gica de actualizaci칩n de Scores
          # date +%w devuelve 0 para domingo, 1-6 para lunes-s치bado
          if [ "$(date +%w)" = "0" ]; then
            echo "Es domingo: Iniciando ESCANEO COMPLETO (--full)"
            python scripts/update_nvd.py --full
          else
            echo "D칤a laborable: Iniciando MANTENIMIENTO R츼PIDO"
            python scripts/update_nvd.py
          fi

      - name: Commit y Push de cambios
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add data/cve.json data/nvd_scores.json
          # Solo hace commit si hay cambios reales para evitar errores
          git diff --quiet && git diff --staged --quiet || (git commit -m "游뱄 Actualizaci칩n autom치tica: CISA KEV e Inteligencia de Scores" && git push)