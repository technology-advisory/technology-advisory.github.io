name: Actualizar Inteligencia CVE

# 1. Definimos cu谩ndo se ejecuta
on:
  schedule:
    - cron: '0 */12 * * *' # Se ejecuta autom谩ticamente cada 12 horas
  workflow_dispatch:      # Permite ejecutarlo manualmente con el bot贸n "Run workflow"

jobs:
  build:
    runs-on: ubuntu-latest # Servidor Linux de GitHub

    steps:
      # A. Descarga tu c贸digo en el servidor
      - name: Checkout del c贸digo
        uses: actions/checkout@v4

      # B. Instala Python
      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      # C. Instala la librer铆a necesaria para las peticiones API
      - name: Instalar dependencias
        run: pip install requests

      # D. Ejecuta los dos scripts en cadena (CISA -> Enriquecedor)
      - name: Ejecutar scripts de actualizaci贸n
        run: |
          python scripts/update_cves.py
          python scripts/update_nvd.py

      # E. Guarda los archivos cve.json y nvd_scores.json en tu GitHub
      - name: Guardar cambios en el repositorio
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # A帽adimos todos los archivos JSON actualizados en la carpeta data
          git add data/*.json
          
          # Solo hace commit si hay cambios reales para no ensuciar el historial
          git commit -m " Actualizaci贸n autom谩tica: CISA KEV y Severidad CVE" || echo "No hay cambios para actualizar"
          
          git push