<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1280">
    <title>Technology Advisory | Infrastructure Intelligence</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">

    <style>
        /* Ajustes espec√≠ficos para que no se rompa el layout */
        .feature-card { min-height: 400px; display: flex; align-items: center; }
        #news-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin-top: 30px; 
        }
        .card { 
            background: var(--card); 
            padding: 25px; 
            border-radius: 16px; 
            border: 1px solid var(--border); 
            display: flex; 
            flex-direction: column; 
            justify-content: space-between;
        }
    </style>
</head>
<body>

<header class="main-header">
    <div class="brand-container">
        <a href="index.html" class="logo-main" style="text-decoration:none;">TECHNOLOGY ADVISORY</a>
        <span class="logo-sub">Enterprise Infrastructure Intelligence</span>
    </div>

    <div class="header-right">
        <div class="header-status" style="display: flex; align-items: center; gap: 15px; border-left: 1px solid var(--border); padding-left: 20px;">
            <div style="display: flex; flex-direction: column;">
                <span id="net-label" style="font-size: 0.6rem; font-weight: 800; color: var(--text-muted);">SINCRONIZANDO...</span>
                <span id="ip-display" style="font-family: 'JetBrains Mono'; font-size: 0.85rem; color: #22d3ee;">0.0.0.0</span>
            </div>
        </div>
        <nav class="nav-links">
            <a href="index.html" class="active">Dashboard</a>
            <a href="investigacion/browser.html">Investigaci√≥n</a>
            <a href="cve/listado-cve-CISA_Catalog_exploited.html">CISA KEV</a>
        </nav>
    </div>
</header>

<main class="full-layout">
    <div class="main-content">
        <div id="hero-noticia">
            <p style="padding: 40px; color: var(--text-muted);">Iniciando sistemas de inteligencia...</p>
        </div>

        <div id="news-grid"></div>
    </div>

    <aside class="side-panel">
        <div class="panel-box">
            <h3>System Status</h3>
            <div style="text-align: center; padding: 20px 0;">
                <span id="cve-count-val" style="font-size: 2.5rem; font-weight: 800; color: var(--accent); font-family: 'JetBrains Mono';">0</span>
                <p style="font-size: 0.6rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px;">CVEs Detectados</p>
            </div>
            <a href="cve/listado-cve-CISA_Catalog_exploited.html" class="btn-ver-mas">Ver Cat√°logo KEV</a>
        </div>
    </aside>
</main>

<script>
    // 1. GESTI√ìN DE RED
    async function syncNetworkInfo() {
        const ipEl = document.getElementById('ip-display');
        const lbEl = document.getElementById('net-label');
        try {
            const response = await fetch('https://ipwhois.app/json/');
            const data = await response.json();
            if (data.success) {
                ipEl.innerText = data.ip;
                lbEl.innerText = data.isp.toUpperCase().includes("VPN") ? 'üõ°Ô∏è NAVEGACI√ìN SEGURA' : 'üåê NAVEGACI√ìN P√öBLICA';
                lbEl.style.color = data.isp.toUpperCase().includes("VPN") ? '#10b981' : '#f59e0b';
            }
        } catch (e) { ipEl.innerText = "OFFLINE"; }
    }

    // 2. CARGA DIN√ÅMICA
    async function loadDashboardData() {
        try {
            const response = await fetch('data/noticias.json?t=' + Date.now());
            const data = await response.json();

            // Renderizar Noticia Hero
            const hero = data.noticia_hero;
            if(hero) {
                document.getElementById('hero-noticia').innerHTML = `
                    <section class="feature-card">
                        <div class="feature-content">
                            <span class="badge ${hero.severidad || 'high'}" style="margin-bottom: 15px;">${hero.tag}</span>
                            <h2 style="font-size: 2rem; margin-bottom: 15px; color: #fff;">${hero.titulo}</h2>
                            <p style="color: var(--text-muted); margin-bottom: 25px; font-size: 1.05rem;">${hero.desc}</p>
                            <a href="investigacion/${hero.archivo}" class="btn-dashboard-nav">Analizar Investigaci√≥n</a>
                        </div>
                        <div class="feature-image">
                            <img src="${hero.imagen}" alt="Hero" style="width:100%; border-radius:12px; opacity:0.8;">
                        </div>
                    </section>
                `;
            }

            // Renderizar Grid
            if(data.notas_tecnicas) {
                document.getElementById('news-grid').innerHTML = data.notas_tecnicas.map(nota => `
                    <div class="card">
                        <div>
                            <span class="badge ${nota.severidad}" style="margin-bottom:10px;">${nota.tag}</span>
                            <h3 style="margin: 10px 0; color:#fff;">${nota.titulo}</h3>
                            <p style="font-size:0.85rem; color:var(--text-muted); margin-bottom:20px;">${nota.desc}</p>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; border-top:1px solid var(--border); padding-top:15px;">
                            <span style="font-size:0.7rem; color:var(--text-muted); font-weight:700;">${nota.fecha}</span>
                            <a href="investigacion/${nota.archivo}" style="color:var(--accent); text-decoration:none; font-weight:800; font-size:0.8rem;">DETALLES ‚Üí</a>
                        </div>
                    </div>
                `).join('');
            }
        } catch (error) { console.error("Fallo en sincronizaci√≥n de datos:", error); }
    }

    // Contador de CVEs
    fetch('data/cve.json').then(r => r.json()).then(d => {
        if(d.vulnerabilities) document.getElementById('cve-count-val').innerText = d.vulnerabilities.length;
    });

    syncNetworkInfo();
    loadDashboardData();
</script>

</body>
</html>